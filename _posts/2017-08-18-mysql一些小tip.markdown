---
layout: post
title: MySQL一些小tip
subtitle: MySQL使用的时候，不少坑，持续整理
date: 2017-08-18 15:16
header-img: "img/head.jpg"
categories: jekyll update
tags:
    - MySQL
---

使用mysql的过程中的一些小问题解决方案，小知识点整理

## datatime use now()


In version 5.6.5, it is possible to set a default value on a datetime column, and even make a column that will update when the row is updated. The type definition:

```
CREATE TABLE foo (
    `creation_time`     DATETIME DEFAULT CURRENT_TIMESTAMP,
    `modification_time` DATETIME ON UPDATE CURRENT_TIMESTAMP
)
```

## mysql\_real\_escape\_stringl()

将原始sql字符串进行编码，加上转义字符

```
unsigned long mysql_real_escape_string(MYSQL *mysql, char *to, const char *from, unsigned long length)
```

The string pointed to by from must be length bytes long. You must allocate the to buffer to be at least 
length\*2+1 bytes long. 
(In the worst case, each character may need to be encoded as using two bytes, and there must be room for the terminating null byte.) When mysql_real_escape_string() returns, the contents of to is a null-terminated string. The return value is the length of the encoded string, not including the terminating null byte.

## query cache

http://www.orczhou.com/index.php/2009/08/query-cache-1/
在MySQL中的Query Cache就是一个适用较少情况的缓存机制, 如果你的应用对数据库的更新很少，那么QC将会作用显著。比较典型的如博客系统，一般博客更新相对较慢，数据表相对稳定不变，这时候QC的作用会比较明显。
如果你的数据表更新频繁的话，那么Query Cache将会成为系统的负担。如果应用层能够实现缓存，将可以忽略QC的效果。


## Mysql Prepared Statement 接口

##### why

+ 安全：Prepared Statements通过sql逻辑与数据的分离来增加安全，sql逻辑与数据的分离能防止普通类型的sql注入攻击
+ 性能：
    1. Prepared Statements只语法分析一次；
    2. 使用binary protocol协议，这样更能提高效率 Save on data conversion and copying;
    3. Save memory on handling blobs

**NOTE**
Query cache does not work


