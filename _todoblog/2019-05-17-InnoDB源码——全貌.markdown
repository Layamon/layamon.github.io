---
layout: post
title: InnoDB源码——全貌
date: 2019-05-17 10:20
header-img: "img/head.jpg"
categories: jekyll update
tags:
  - InnoDB
typora-root-url: ../../yummyliu.github.io
---

* TOC
{:toc}
# OSX下的MySQL5.7调试环境

```bash
mysql57 @5.7.17: error: no type named 'self_ip_exception' in namespace 'boost::geometry::detail::self_get_turn_points'
```

上述错误是本地的boost库版本不是特定的 1.59；将本地boost库'brew uninstall boost'后，重新cmake成功。

`cmake . -DDOWNLOAD_BOOST=1 -DWITH_BOOST=/usr/local/Cellar -DWITH_DEBUG=1`

然后，make、make install；

## 初始化

```bash
#初始化数据目录
/usr/local/mysql/bin/mysqld --initialize --user=liuyangming --basedir=/usr/local/mysql --datadir=/Users/liuyangming/dbdata/mysql/data

> /usr/local/mysql/bin/mysqld --initialize --user=liuyangming --basedir=/usr/local/mysql --datadir=/Users/liuyangming/dbdata/mysql/data
2019-06-11T09:33:36.339696Z 0 [Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details).
2019-06-11T09:33:36.343094Z 0 [Warning] Setting lower_case_table_names=2 because file system for /Users/liuyangming/dbdata/mysql/data/ is case insensitive
2019-06-11T09:33:36.683098Z 0 [Warning] InnoDB: New log files created, LSN=45790
2019-06-11T09:33:36.826801Z 0 [Warning] InnoDB: Creating foreign key constraint system tables.
2019-06-11T09:33:36.904487Z 0 [Warning] No existing UUID has been found, so we assume that this is the first time that this server has been started. Generating a new UUID: fd159870-8c2b-11e9-a017-4a930459b57e.
2019-06-11T09:33:36.921158Z 0 [Warning] Gtid table is not ready to be used. Table 'mysql.gtid_executed' cannot be opened.
2019-06-11T09:33:36.923575Z 1 [Note] A temporary password is generated for root@localhost: ;2nu=q02Beiq

#启动mysql服务
/usr/local/mysql/bin/mysqld_safe --skip-grant-tables  --datadir=/Users/liuyangming/dbdata/mysql/data &

#检查
> bin/mysqladmin version
bin/mysqladmin  Ver 8.42 Distrib 5.7.26, for osx10.14 on x86_64
Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Server version          5.7.26-debug
Protocol version        10
Connection              Localhost via UNIX socket
UNIX socket             /tmp/mysql.sock
Uptime:                 18 sec

Threads: 1  Questions: 4  Slow queries: 0  Opens: 96  Flush tables: 1  Open tables: 91  Queries per second avg: 0.222


#停止MySQL服务
bin/mysqladmin shutdown
```



https://dbtut.com/index.php/2018/09/21/benchmark-performance-of-mysql-using-sysbench/



https://unix.stackexchange.com/questions/476802/install-mysql-5-7-using-bash-script-with-centos



```



sysbench /usr/share/sysbench/oltp_read_write.lua --mysql-host=localhost --mysql-port=3306 --mysql-user=root --mysql-password='Newhakase-labs123@' --mysql-db=sbtest --db-driver=mysql --tables=3 --table-size=10000000  prepare





sysbench /usr/share/sysbench/oltp_read_write.lua --mysql-host=localhost --mysql-port=3306 --mysql-user=root --mysql-password='Newhakase-labs123@' --mysql-db=sbtest --db-driver=mysql --tables=3 --table-size=10000000 --report-interval=10 --threads=128 --time=600 run 2>&1
```







effective-disk 335

```
SQL statistics:
    queries performed:
        read:                            2819572
        write:                           805592
        other:                           402796
        total:                           4027960
    transactions:                        201398 (335.25 per sec.)
    queries:                             4027960 (6705.05 per sec.)
    ignored errors:                      0      (0.00 per sec.)
    reconnects:                          0      (0.00 per sec.)

General statistics:
    total time:                          600.7334s
    total number of events:              201398

Latency (ms):
         min:                                  5.42
         avg:                                381.67
         max:                               5028.89
         95th percentile:                    995.51
         sum:                            76867286.91

Threads fairness:
    events (avg/stddev):           1573.4219/30.95
    execution time (avg/stddev):   600.5257/0.18
```

cloud-disk-3.0 242

```
SQL statistics:
    queries performed:
        read:                            2040500
        write:                           583000
        other:                           291500
        total:                           2915000
    transactions:                        145750 (242.77 per sec.)
    queries:                             2915000 (4855.43 per sec.)
    ignored errors:                      0      (0.00 per sec.)
    reconnects:                          0      (0.00 per sec.)

General statistics:
    total time:                          600.3571s
    total number of events:              145750

Latency (ms):
         min:                                  5.94
         avg:                                527.17
         max:                               8215.67
         95th percentile:                   1648.20
         sum:                            76835164.59

Threads fairness:
    events (avg/stddev):           1138.6719/29.13
    execution time (avg/stddev):   600.2747/0.03
```



local-ssd 2141

```
SQL statistics:
    queries performed:
        read:                            17987984
        write:                           5139424
        other:                           2569712
        total:                           25697120
    transactions:                        1284856 (2141.11 per sec.)
    queries:                             25697120 (42822.21 per sec.)
    ignored errors:                      0      (0.00 per sec.)
    reconnects:                          0      (0.00 per sec.)

General statistics:
    total time:                          600.0873s
    total number of events:              1284856

Latency (ms):
         min:                                  1.52
         avg:                                 59.78
         max:                                715.62
         95th percentile:                    144.97
         sum:                            76804222.50

Threads fairness:
    events (avg/stddev):           10037.9375/63.52
    execution time (avg/stddev):   600.0330/0.01
```

